<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IDEAL ç†æƒ³ä¿éšª - æ™ºèƒ½å»ºè­°æ›¸è©¦ç®—</title>
    <style>
        /* --- CSS æ¨£å¼å€ --- */
        :root {
            --primary-color: #E65100; /* æ·±æ©˜è‰² */
            --accent-color: #FB8C00;  /* äº®æ©˜è‰² */
            --light-bg: #FFF3E0;      /* æ·ºæ©˜èƒŒæ™¯ */
            --text-color: #333;
            --warning-text: #757575;
            --success-color: #2e7d32;
            --danger-color: #c62828;
        }

        body {
            font-family: "Microsoft JhengHei", "Heiti TC", sans-serif;
            margin: 0;
            padding: 0;
            background-color: #fafafa;
            color: var(--text-color);
            line-height: 1.6;
        }

        /* æ¨™é¡Œå€ */
        header {
            background-color: var(--primary-color);
            color: white;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        header h1 { margin: 0; font-size: 1.5rem; text-shadow: 1px 1px 2px rgba(0,0,0,0.2); }
        header p { margin: 5px 0 0; font-size: 0.9rem; opacity: 0.95; }

        /* å®¹å™¨è¨­å®š */
        .container {
            max-width: 600px;
            margin: 20px auto;
            padding: 0 15px;
            padding-bottom: 80px;
        }

        /* å¡ç‰‡æ¨£å¼ */
        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.08);
            border-top: 4px solid var(--accent-color);
        }

        .card-title {
            color: var(--primary-color);
            font-size: 1.2rem;
            margin-bottom: 15px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
            font-weight: bold;
        }

        /* å¼•ç™¼èˆˆè¶£åˆ—è¡¨ */
        .hook-list li {
            margin-bottom: 10px;
            font-weight: bold;
            color: #444;
            list-style-type: none;
            padding-left: 10px;
            border-left: 3px solid var(--accent-color);
        }
        .highlight { color: #D84315; font-weight: 800; }

        /* è¼¸å…¥æ¬„ä½æ¨£å¼ */
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; font-size: 0.95rem; color: #444; }
        input[type="number"], select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
            box-sizing: border-box;
            background-color: #fff;
        }
        input:focus, select:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 5px rgba(251, 140, 0, 0.3);
        }

        /* æŒ‰éˆ•ç¾¤çµ„ */
        .radio-group { display: flex; gap: 10px; margin-bottom: 15px; }
        .radio-label {
            flex: 1; text-align: center; padding: 10px;
            border: 1px solid #ddd; border-radius: 5px;
            cursor: pointer; font-weight: bold; transition: all 0.2s;
            background: #f9f9f9; color: #666;
            font-size: 0.9rem;
        }
        .radio-input { display: none; }
        .radio-input:checked + .radio-label {
            background-color: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        /* æ¨¡å¼åˆ‡æ› Tabs */
        .mode-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #eee;
        }
        .mode-tab {
            flex: 1; text-align: center; padding: 12px;
            cursor: pointer; font-weight: bold; color: #999;
            border-bottom: 3px solid transparent; transition: all 0.3s;
        }
        .mode-tab.active {
            color: var(--primary-color);
            border-bottom: 3px solid var(--primary-color);
            background-color: #FFF3E0;
        }

        /* éš±è—å€å¡Šæ§åˆ¶ */
        .input-section { display: none; }
        .input-section.active { display: block; }
        
        /* å¹´æœŸè¼¸å…¥å€å¡Š (Flexæ’ç‰ˆ) */
        .years-row { display: flex; gap: 10px; }
        .years-col { flex: 1; }

        /* å»ºè­°æ–‡å­—å€å¡Š (å‹•æ…‹) */
        .advice-box {
            font-size: 0.95rem; 
            color: #5D4037; 
            margin-top:10px; 
            font-weight:normal; 
            background: #FFECB3; 
            padding: 15px; 
            border-radius: 5px; 
            border-left: 5px solid #FFC107;
            display: none;
            line-height: 1.6;
        }
        .advice-section-title {
            font-weight: bold;
            color: #E65100;
            display: block;
            margin-bottom: 5px;
        }

        /* æ§“æ¡¿å€å¡Š */
        .advanced-section {
            background-color: #FFF8E1;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px dashed var(--accent-color);
            display: none;
        }

        /* åˆ‡æ›é–‹é—œ */
        .toggle-container {
            display: flex; align-items: center;
            margin-bottom: 15px; cursor: pointer;
            padding: 12px; background: #fff;
            border: 1px solid #eee; border-radius: 5px;
        }
        .toggle-checkbox { width: 18px; height: 18px; margin-right: 10px; cursor: pointer; accent-color: var(--primary-color); }
        .toggle-label { font-weight: bold; color: var(--text-color); cursor: pointer; }

        /* æŒ‰éˆ• */
        .btn {
            display: block; width: 100%; padding: 14px;
            background: linear-gradient(135deg, var(--accent-color), var(--primary-color));
            color: white; border: none; border-radius: 50px;
            font-size: 1.1rem; cursor: pointer; font-weight: bold;
            box-shadow: 0 4px 6px rgba(230, 81, 0, 0.3); transition: transform 0.1s;
        }
        .btn:active { transform: scale(0.98); }

        /* çµæœé¡¯ç¤ºå€ */
        .result-box {
            background-color: #FFF3E0; border: 1px solid #FFCC80;
            padding: 20px; border-radius: 8px; text-align: center;
            margin-top: 20px; display: none;
        }
        .result-row {
            display: flex; justify-content: space-between;
            margin-bottom: 10px; font-size: 0.95rem;
            border-bottom: 1px dashed #e0e0e0; padding-bottom: 8px;
        }
        .result-value { font-weight: bold; color: #333; }
        
        .big-number {
            font-size: 2.2rem; color: var(--primary-color);
            font-weight: 800; margin: 10px 0;
            font-family: Arial, sans-serif; line-height: 1.1;
        }

        /* è­¦ç¤ºæ–‡å­— */
        .disclaimer-box {
            margin-top: 30px; padding: 15px;
            background-color: #f5f5f5; border-top: 2px solid #ddd;
            font-size: 0.75rem; color: var(--warning-text);
            line-height: 1.4; text-align: justify;
        }
        .disclaimer-box h4 { margin: 0 0 5px 0; font-size: 0.85rem; color: #444; }
        .disclaimer-box ul { padding-left: 20px; margin: 0; }

        footer { text-align: center; padding: 20px; font-size: 0.8rem; color: #999; }
    </style>
</head>
<body>

    <header>
        <h1>IDEAL ç†æƒ³ä¿éšª</h1>
        <p>YOUR FUTURE AS YOU WANT</p>
    </header>

    <div class="container">
        
        <div class="card">
            <h2 class="card-title">æ‚¨æƒ³éé€™æ¨£çš„æœªä¾†å—ï¼Ÿ</h2>
            <ul class="hook-list">
                <li>æ¯å¹´ <span class="highlight">6-8%</span> é¡å®šå­˜æ”¶ç›Šï¼Œæ‚¨æœ‰èˆˆè¶£å—ï¼Ÿ</li>
                <li>è®“å°ˆæ¥­çš„åŸºé‡‘ç¶“ç†äººå¹«æ‚¨ç´¯ç©è²¡å¯Œã€‚</li>
                <li>æŠ•è³‡åŒæ™‚äº«æœ‰é«˜é¡å£½éšªèº«åƒ¹ï¼Œè³‡ç”¢å‚³æ‰¿æ›´å®‰å¿ƒã€‚</li>
            </ul>
        </div>

        <div class="card">
            <h2 class="card-title">æ­¥é©Ÿ 1ï¼šè¦åŠƒç›®æ¨™</h2>
            <div class="form-group">
                <label for="userAge">æ‚¨çš„å¹´é½¡ï¼š</label>
                <input type="number" id="userAge" value="40" placeholder="ä¾‹å¦‚ï¼š40" oninput="renderSmartAdvice()">
            </div>
            
            <div class="form-group">
                <label for="investmentGoal" style="color:var(--primary-color); font-size:1.1rem;">æ‚¨çš„æŠ•è³‡ä¸»è¦ç›®æ¨™ï¼Ÿ</label>
                <select id="investmentGoal" onchange="applyInvestmentGoal()">
                    <option value="none">-- é¸æ“‡ç›®æ¨™ä»¥ç²å¾—å°ˆæ¥­é…ç½®å»ºè­° --</option>
                    <option value="cashflow">1. å‰µé€ é€€ä¼‘ç¾é‡‘æµ (æ›¿ä»£è–ªè³‡)</option>
                    <option value="legacy">2. ç¨…å‹™è¦åŠƒèˆ‡è³‡ç”¢å‚³æ‰¿ (é ç•™ç¨…æº)</option>
                    <option value="accumulation">3. è³‡ç”¢å¿«é€Ÿå¢å€¼ (è³¼å±‹/åœ“å¤¢)</option>
                </select>
            </div>
            
            <div id="advice-text" class="advice-box"></div>
        </div>

        <div class="card">
            <h2 class="card-title">æ­¥é©Ÿ 2ï¼šæŠ•è³‡èˆ‡è©¦ç®—</h2>
            
            <div class="mode-tabs">
                <div class="mode-tab active" onclick="switchMode('lumpSum')" id="tabLumpSum">å–®ç­†æŠ•å…¥ (æ•´ç­†å­˜)</div>
                <div class="mode-tab" onclick="switchMode('regular')" id="tabRegular">å®šæœŸå®šé¡ (æœˆæœˆå­˜)</div>
            </div>

            <div id="inputLumpSum" class="input-section active">
                <div class="form-group">
                    <label for="principal">å–®ç­†æŠ•å…¥æœ¬é‡‘ (å…ƒ)ï¼š</label>
                    <input type="number" id="principal" value="1000000" step="10000">
                </div>
            </div>

            <div id="inputRegular" class="input-section">
                <div class="form-group">
                    <label for="monthlyAmount">æ¯æœˆæŠ•å…¥é‡‘é¡ (å…ƒ)ï¼š</label>
                    <input type="number" id="monthlyAmount" value="5000" step="1000">
                    <small style="color:#666;">â€» æ¯æœˆæŒçºŒæ‰£æ¬¾æŠ•è³‡</small>
                </div>
            </div>

             <div class="form-group">
                <label for="insuranceAmount">å¸Œæœ›å£½éšªä¿é¡ (å…ƒ)ï¼š</label>
                <input type="number" id="insuranceAmount" value="3000000" step="100000">
                <small style="color:#666;">â€» å°‡ä¾å¹´é½¡è‡ªå‹•æ‰£é™¤å°æ‡‰çš„å±éšªä¿è²» (ç”²å‹)</small>
            </div>

            <div class="form-group">
                <label>ç²åˆ©é‹ç”¨æ–¹å¼ï¼š</label>
                <div class="radio-group">
                    <input type="radio" id="typeCash" name="payoutType" class="radio-input" value="cash" checked>
                    <label for="typeCash" class="radio-label">æ¯æœˆé ˜ç¾ (ç¾é‡‘æµ)</label>
                    
                    <input type="radio" id="typeCompound" name="payoutType" class="radio-input" value="compound">
                    <label for="typeCompound" class="radio-label">è¤‡åˆ©æ»¾å­˜ (è³‡ç”¢å¢å€¼)</label>
                </div>
            </div>

            <div class="form-group">
                <label for="rate">é ä¼°å¹´åŒ–å ±é…¬ç‡ (%)ï¼š</label>
                <input type="number" id="rate" value="6.0" step="0.1">
                <small style="color:#999;">â€» è«‹æ‰‹å‹•è¼¸å…¥é ä¼°æ•¸å€¼ (å¦‚ï¼šåŸºé‡‘é…æ¯ç‡)</small>
            </div>

            <div id="yearsInputContainer">
                </div>

            <div id="leverageWrapper">
                <div class="toggle-container" onclick="toggleLeverage()">
                    <input type="checkbox" id="leverageToggle" class="toggle-checkbox">
                    <span class="toggle-label">é–‹å•Ÿã€Œæ§“æ¡¿/è²¸æ¬¾ã€è©¦ç®— (é€²éš)</span>
                </div>

                <div id="leverageSection" class="advanced-section">
                    <div class="form-group">
                        <label>è³‡é‡‘ç”¨é€”ï¼š</label>
                        <div class="radio-group">
                            <input type="radio" id="loanInvest" name="loanType" class="radio-input" value="invest" checked>
                            <label for="loanInvest" class="radio-label">è²¸æ¬¾å†æŠ•å…¥ (æ§“æ¡¿å¥—åˆ©)</label>
                            
                            <input type="radio" id="loanKeep" name="loanType" class="radio-input" value="keep">
                            <label for="loanKeep" class="radio-label">è²¸æ¬¾ä¸æŠ•å…¥ (åƒ…æ‰£åˆ©æ¯)</label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="loanAmount">è²¸æ¬¾é‡‘é¡ (å…ƒ)ï¼š</label>
                        <input type="number" id="loanAmount" value="1000000" step="10000">
                        <small style="color:#795548;">(ä¾‹å¦‚ï¼šæˆ¿è²¸å¢è²¸ã€ä¿å–®å€Ÿæ¬¾)</small>
                    </div>
                    <div class="form-group">
                        <label for="loanRate">è²¸æ¬¾å¹´åˆ©ç‡ (%)ï¼š</label>
                        <input type="number" id="loanRate" value="2.5" step="0.1">
                    </div>
                </div>
            </div>

            <button class="btn" onclick="calculate()">é–‹å§‹è©¦ç®—</button>

            <div class="result-box" id="resultArea">
                
                <h3 style="margin-top:0; color: var(--primary-color);">è©¦ç®—çµæœ (<span id="resYearLabel">10</span>å¹´å¾Œ)</h3>

                <div style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; border: 2px solid var(--accent-color); box-shadow: 0 4px 6px rgba(0,0,0,0.05);">
                    <div style="font-size: 1rem; color: #666; font-weight:bold;">ç¸½è³‡ç”¢æ•ˆç›Š (æœ¬é‡‘+ç²åˆ©)</div>
                    <div style="font-size: 0.8rem; color: #999; margin-bottom: 5px;">(å«ï¼šå¸³æˆ¶é¤˜é¡ + ç´¯ç©å·²é ˜ç¾é‡‘)</div>
                    
                    <div class="big-number" id="resTotalBenefit">NT$ 0</div>

                    <div style="margin-top: 15px; border-top: 1px dashed #ccc; padding-top: 10px; font-size: 0.9rem;">
                        <div class="result-row">
                            <span>ç´¯ç©æŠ•å…¥æœ¬é‡‘</span>
                            <span class="result-value" id="resPrincipal">NT$ 0</span>
                        </div>
                        <div class="result-row" style="color: var(--success-color);">
                            <span>ç´¯ç©æ·¨ç²åˆ©</span>
                            <span class="result-value" id="resNetProfit">NT$ 0</span>
                        </div>
                        <div id="loanCostRow" class="result-row" style="color: var(--danger-color); display:none;">
                            <span>(å·²æ‰£é™¤ç´¯ç©è²¸æ¬¾åˆ©æ¯)</span>
                            <span class="result-value" id="resTotalLoanInterest">- NT$ 0</span>
                        </div>
                    </div>
                </div>

                <div style="background: #fff; padding: 15px; border-radius: 8px; margin-bottom: 15px; border: 1px solid #eee; text-align:left;">
                    <h4 style="margin:0 0 10px 0; color: var(--primary-color); border-bottom: 2px solid #eee; padding-bottom:5px;">è³‡ç”¢åˆ†ä½ˆæ˜ç´°</h4>
                    
                    <div class="result-row">
                        <span>A. ä¿å–®å¸³æˆ¶é¤˜é¡</span>
                        <span class="result-value" id="resAccountValue">NT$ 0</span>
                    </div>
                    
                    <div class="result-row">
                        <span>B. ç´¯ç©å·²é ˜ç¾é‡‘</span>
                        <span class="result-value" id="resTotalDraw">NT$ 0</span>
                    </div>
                    
                    <div id="monthlyDrawRow" class="result-row" style="background:#FFF3E0; padding:15px; border-radius:8px; margin-top:15px; display:none; align-items: center;">
                        <span style="font-weight:bold; color:var(--primary-color); font-size: 1.1rem;">å¹³å‡æ¯æœˆç´„é ˜</span>
                        <span class="result-value" id="resMonthlyDraw" style="color:var(--primary-color); font-size: 1.8rem;">NT$ 0</span>
                    </div>
                </div>

                <div style="background: #E8F5E9; padding: 15px; border-radius: 8px; border: 1px solid #C8E6C9;">
                    <div style="font-size: 0.9rem; color: #2E7D32; margin-bottom: 5px; font-weight:bold;">èº«æ•…ç¸½çµ¦ä»˜ (å®¶äººä¿éšœ)</div>
                    <div class="big-number" id="resDeathBenefit" style="color: #2E7D32; font-size: 1.8rem;">NT$ 0</div>
                    <div class="result-row">
                        <span>è¦åŠƒå£½éšªä¿é¡</span>
                        <span class="result-value" id="resSumAssured">NT$ 0</span>
                    </div>
                     <div class="result-row" style="font-size:0.8rem; color:#666;">
                        <span>*è‹¥å¸³æˆ¶åƒ¹å€¼é«˜æ–¼ä¿é¡ï¼Œä¾å¸³æˆ¶åƒ¹å€¼çµ¦ä»˜ (ç”²å‹)</span>
                    </div>
                </div>

                <div id="roeBlock" style="margin-top: 15px; padding-top: 10px; border-top: 2px solid var(--accent-color); display:none;">
                    <div class="result-row">
                        <span>è‡ªæœ‰è³‡é‡‘å¹´åŒ–å ±é…¬ç‡ (ROE)</span>
                        <span class="result-value" id="resROE" style="font-size: 1.5rem; color: var(--primary-color);">0%</span>
                    </div>
                    <small style="color:#666;">(å·²æ‰£é™¤è²¸æ¬¾åˆ©æ¯æˆæœ¬)</small>
                </div>

            </div>
        </div>

        <div class="disclaimer-box">
            <h4>æ³¨æ„äº‹é …èˆ‡é¢¨éšªæ­éœ²ï¼š</h4>
            <ul>
                <li><strong>ç¸½è³‡ç”¢æ•ˆç›Šèªªæ˜ï¼š</strong>ä¸Šè¿°é‡‘é¡ç‚ºã€Œä¿å–®å¸³æˆ¶é¤˜é¡ã€åŠ ä¸Šã€Œç´¯ç©å·²é ˜å›ä¹‹ç¾é‡‘ã€ã€‚è‹¥é¸æ“‡æ¯æœˆé ˜ç¾ï¼Œå¸³æˆ¶é¤˜é¡å¯èƒ½å› æ‰£é™¤ä¿è²»èˆ‡é…æ¯è€Œä½æ–¼åŸå§‹æœ¬é‡‘ã€‚</li>
                <li><strong>å®šæœŸå®šé¡ï¼š</strong>è©¦ç®—å‡è¨­æ¯æœˆæœŸåˆæŠ•å…¥ã€‚è‹¥è¨­å®šã€Œç¹³è²»å¹´æœŸã€å°æ–¼ã€Œç¸½æŒæœ‰å¹´æœŸã€ï¼ŒæœŸæ»¿å¾Œä¸å†æŠ•å…¥è³‡é‡‘ï¼Œä½†å¸³æˆ¶åƒ¹å€¼æŒçºŒä¾é ä¼°å ±é…¬ç‡è¤‡åˆ©æ»¾å­˜ä¸¦æ‰£é™¤ä¿éšªæˆæœ¬ã€‚</li>
                <li><strong>ä¿éšªæˆæœ¬æ‰£é™¤ï¼š</strong>æœ¬è©¦ç®—å·²æ¨¡æ“¬ã€Œå±éšªä¿è²»ã€éš¨å¹´é½¡å¢é•·ä¹‹æ‰£é™¤æ©Ÿåˆ¶ (å‡è¨­ç”²å‹å£½éšª)ï¼Œä¸”å¸³æˆ¶åƒ¹å€¼è¶Šé«˜ï¼Œå±éšªä¿è²»æ‰£é™¤è¶Šå°‘ã€‚</li>
                <li><strong>æŠ•è³‡é¢¨éšªï¼š</strong>æœ¬è©¦ç®—å ±é…¬ç‡åƒ…ä¾›åƒè€ƒï¼Œä¸ä»£è¡¨æœªä¾†ç¸¾æ•ˆï¼Œä¿æˆ¶éœ€è‡ªè² æŠ•è³‡ç›ˆè™§ã€‚åŸºé‡‘é…æ¯ä¾†æºå¯èƒ½ç‚ºæœ¬é‡‘ã€‚</li>
            </ul>
        </div>

    </div>

    <footer>
        <p>Copyright Â© IDEAL ç†æƒ³ä¿éšª</p>
    </footer>

    <script>
        /* --- JavaScript æ ¸å¿ƒé‚è¼¯å€ --- */

        let currentMode = 'lumpSum';

        window.onload = function() {
            renderTimeInputs();
            renderSmartAdvice(); 
        };

        // --- æ ¸å¿ƒåŠŸèƒ½ï¼šé›™é‡å»ºè­°ç³»çµ± ---
        function renderSmartAdvice() {
            const age = parseInt(document.getElementById('userAge').value);
            const goal = document.getElementById('investmentGoal').value;
            const adviceBox = document.getElementById('advice-text');
            
            let htmlContent = "";

            // 1. å¹´é½¡å»ºè­°
            if (age) {
                let ageAdvice = "";
                if (age >= 18 && age <= 35) {
                    ageAdvice = "ğŸ’¡ <strong>é’å¹´éšæ®µå»ºè­° (18-35æ­²)ï¼š</strong><br>è·é›¢é€€ä¼‘æ™‚é–“é•·ï¼Œé©åˆé¸æ“‡<strong>ç©æ¥µå‹é…ç½® (ETF/è‚¡ç¥¨å‹åŸºé‡‘)</strong>ï¼Œåˆ©ç”¨æ™‚é–“è¤‡åˆ©åŠ é€Ÿè³‡ç”¢ç´¯ç©ã€‚";
                } else if (age >= 36 && age <= 55) {
                    ageAdvice = "ğŸ’¡ <strong>å£¯å¹´éšæ®µå»ºè­° (36-55æ­²)ï¼š</strong><br>å®¶åº­è²¬ä»»é‡ï¼Œå»ºè­°<strong>è‚¡å‚µå¹³è¡¡é…ç½®</strong>ï¼ŒåŒæ™‚å…¼é¡§è³‡ç”¢ç´¯ç©èˆ‡å®¶åº­ä¿éšœã€‚";
                } else if (age > 55) {
                    ageAdvice = "ğŸ’¡ <strong>é€€ä¼‘éšæ®µå»ºè­° (55æ­²+)ï¼š</strong><br>å»ºè­°ä»¥<strong>ã€Œç©©å®šç¾é‡‘æµã€</strong>èˆ‡ä¿å®ˆå‹è³‡ç”¢ç‚ºä¸»ï¼Œå‰µé€ æºæºä¸çµ•çš„è¢«å‹•æ”¶å…¥ã€‚";
                }
                htmlContent += `<div style="margin-bottom:10px;">${ageAdvice}</div>`;
            }

            // 2. ç›®æ¨™å»ºè­°
            if (goal !== 'none') {
                let goalAdvice = "";
                if (goal === 'cashflow') {
                    goalAdvice = "<span class='advice-section-title'>é‡å°ã€é€€ä¼‘ç¾é‡‘æµã€‘é…ç½®ï¼š</span>å»ºè­°å–®ç­†æŠ•å…¥ 200 è¬ä»¥ä¸Šï¼Œä¸¦é¸æ“‡ã€Œæ¯æœˆé ˜ç¾ã€ï¼Œå‰µé€ æ›¿ä»£è–ªè³‡ã€‚";
                } else if (goal === 'legacy') {
                    goalAdvice = "<span class='advice-section-title'>é‡å°ã€è³‡ç”¢å‚³æ‰¿ã€‘é…ç½®ï¼š</span>å»ºè­°æé«˜å£½éšªä¿é¡ (1,000è¬+)ï¼Œåˆ©ç”¨ç”²å‹ä¿å–®ç‰¹æ€§èˆ‡è¤‡åˆ©æ»¾å­˜ï¼Œé ç•™ç¨…æºä¸¦æ”¾å¤§èº«åƒ¹ã€‚";
                } else if (goal === 'accumulation') {
                    goalAdvice = "<span class='advice-section-title'>é‡å°ã€è³‡ç”¢å¢å€¼ã€‘é…ç½®ï¼š</span>å»ºè­°åˆ©ç”¨ã€Œå®šæœŸå®šé¡ã€æ­é…ã€Œè¤‡åˆ©æ»¾å­˜ã€ï¼Œé€éæ™‚é–“å¹³æ”¤æˆæœ¬ï¼Œé©åˆç´¯ç©æ•™è‚²é‡‘ã€‚";
                }
                if(htmlContent !== "") htmlContent += "<hr style='border:0; border-top:1px dashed #D7CCC8; margin:8px 0;'>";
                htmlContent += `<div>${goalAdvice}</div>`;
            }

            if (htmlContent !== "") {
                adviceBox.style.display = 'block';
                adviceBox.innerHTML = htmlContent;
            } else {
                adviceBox.style.display = 'none';
            }
        }

        // --- ç›®æ¨™é€£å‹•è¨­å®š ---
        function applyInvestmentGoal() {
            const goal = document.getElementById('investmentGoal').value;
            const principalInput = document.getElementById('principal');
            const insuranceInput = document.getElementById('insuranceAmount');
            const typeCashRadio = document.getElementById('typeCash');
            const typeCompoundRadio = document.getElementById('typeCompound');
            
            if (goal === 'cashflow') {
                switchMode('lumpSum');
                principalInput.value = 2000000;
                typeCashRadio.checked = true;
            } else if (goal === 'legacy') {
                switchMode('lumpSum');
                insuranceInput.value = 10000000; 
                typeCompoundRadio.checked = true;
            } else if (goal === 'accumulation') {
                switchMode('regular'); 
                typeCompoundRadio.checked = true;
            }
            renderTimeInputs();
            renderSmartAdvice(); 
        }

        // --- æ¨¡å¼åˆ‡æ› ---
        function switchMode(mode) {
            currentMode = mode;
            document.getElementById('tabLumpSum').className = mode === 'lumpSum' ? 'mode-tab active' : 'mode-tab';
            document.getElementById('tabRegular').className = mode === 'regular' ? 'mode-tab active' : 'mode-tab';
            document.getElementById('inputLumpSum').className = mode === 'lumpSum' ? 'input-section active' : 'input-section';
            document.getElementById('inputRegular').className = mode === 'regular' ? 'input-section active' : 'input-section';

            const leverageWrapper = document.getElementById('leverageWrapper');
            if (mode === 'regular') {
                leverageWrapper.style.display = 'none';
                document.getElementById('leverageToggle').checked = false;
                document.getElementById('leverageSection').style.display = 'none';
            } else {
                leverageWrapper.style.display = 'block';
            }
            renderTimeInputs();
        }

        // --- å¹´æœŸè¼¸å…¥æ¡†æ¸²æŸ“ ---
        function renderTimeInputs() {
            const container = document.getElementById('yearsInputContainer');
            if (currentMode === 'lumpSum') {
                container.innerHTML = `
                    <div class="form-group">
                        <label for="totalYears">è©¦ç®—ç¸½æŒæœ‰å¹´æœŸ (å¹´)ï¼š</label>
                        <input type="number" id="totalYears" value="10" step="1">
                    </div>
                `;
            } else {
                container.innerHTML = `
                    <div class="years-row">
                        <div class="years-col form-group">
                            <label for="payYears">é è¨ˆç¹³è²»å¹´æœŸ (å¹´)ï¼š</label>
                            <input type="number" id="payYears" value="20" step="1">
                        </div>
                        <div class="years-col form-group">
                            <label for="totalYears">ç¸½æŒæœ‰å¹´æœŸ (å¹´)ï¼š</label>
                            <input type="number" id="totalYears" value="25" step="1">
                            <small style="color:#666; font-size:0.8rem;">(åŒ…å«å¾ŒçºŒæ»¾å­˜æ™‚é–“)</small>
                        </div>
                    </div>
                `;
            }
        }

        // --- å±éšªä¿è²»è©¦ç®— ---
        function getMonthlyCOIRate(age) {
            let baseRate = 1.5; 
            if (age < 20) return 0.5;
            let rate = baseRate * Math.pow(1.08, (age - 30));
            return rate > 0 ? rate : 0.5;
        }

        function toggleLeverage() {
            const isChecked = document.getElementById('leverageToggle').checked;
            document.getElementById('leverageSection').style.display = isChecked ? 'block' : 'none';
        }

        // --- æ ¸å¿ƒè¨ˆç®— ---
        function calculate() {
            let age = parseInt(document.getElementById('userAge').value) || 40;
            let sumAssured = parseFloat(document.getElementById('insuranceAmount').value) || 0;
            let rate = parseFloat(document.getElementById('rate').value) || 0;
            let payoutType = document.querySelector('input[name="payoutType"]:checked').value;
            
            let totalYears = parseInt(document.getElementById('totalYears').value) || 10;
            let payYears = totalYears; 
            
            if (currentMode === 'regular') {
                payYears = parseInt(document.getElementById('payYears').value) || totalYears;
                if (payYears > totalYears) {
                    alert("æ³¨æ„ï¼šã€Œç¹³è²»å¹´æœŸã€ä¸èƒ½å¤§æ–¼ã€Œç¸½æŒæœ‰å¹´æœŸã€ï¼Œå·²è‡ªå‹•å°‡ç¸½å¹´æœŸèª¿æ•´ç‚ºç¹³è²»å¹´æœŸã€‚");
                    totalYears = payYears;
                    document.getElementById('totalYears').value = totalYears;
                }
            }

            let isLeverage = (currentMode === 'lumpSum') && document.getElementById('leverageToggle').checked;
            let loanType = document.querySelector('input[name="loanType"]:checked').value; 
            let loanAmount = isLeverage ? (parseFloat(document.getElementById('loanAmount').value) || 0) : 0;
            let loanRate = isLeverage ? (parseFloat(document.getElementById('loanRate').value) || 0) : 0;

            let principal = 0;
            let monthlyPremium = 0;

            if (currentMode === 'lumpSum') {
                principal = parseFloat(document.getElementById('principal').value) || 0;
            } else {
                monthlyPremium = parseFloat(document.getElementById('monthlyAmount').value) || 0;
                principal = 0; 
            }

            let initialPolicyValue = principal;
            if (currentMode === 'lumpSum' && isLeverage && loanType === 'invest') {
                initialPolicyValue += loanAmount;
            }

            let currentAccountValue = initialPolicyValue;
            let totalCashDraw = 0; 
            let totalLoanInterestPaid = 0;
            let accumulatedPrincipal = principal; 

            let months = totalYears * 12;
            let payMonths = payYears * 12;
            let monthlyInvestRate = (rate / 100) / 12;
            let monthlyLoanRate = (loanRate / 100) / 12;

            for (let m = 0; m < months; m++) {
                let currentAge = age + Math.floor(m / 12);

                if (currentMode === 'regular' && m < payMonths) {
                    currentAccountValue += monthlyPremium;
                    accumulatedPrincipal += monthlyPremium;
                }

                let gain = currentAccountValue * monthlyInvestRate;

                let riskAmount = Math.max(sumAssured - currentAccountValue, 0);
                let coiRate = getMonthlyCOIRate(currentAge); 
                let costOfInsurance = (riskAmount / 10000) * coiRate;

                let loanInterest = loanAmount * monthlyLoanRate;
                totalLoanInterestPaid += loanInterest;

                currentAccountValue += gain; 
                currentAccountValue -= costOfInsurance; 

                if (payoutType === 'cash') {
                    let targetDraw = currentAccountValue * monthlyInvestRate; 
                    currentAccountValue -= targetDraw; 
                    
                    if (isLeverage) {
                        let netDraw = targetDraw - loanInterest;
                        totalCashDraw += netDraw; 
                    } else {
                        totalCashDraw += targetDraw;
                    }
                } else {
                    if (isLeverage) {
                        currentAccountValue -= loanInterest;
                    }
                }
            }

            document.getElementById('resAccountValue').innerText = "NT$ " + Math.round(currentAccountValue).toLocaleString();
            document.getElementById('resTotalDraw').innerText = "NT$ " + Math.round(totalCashDraw).toLocaleString();

            let totalBenefit = currentAccountValue + totalCashDraw;
            document.getElementById('resTotalBenefit').innerText = "NT$ " + Math.round(totalBenefit).toLocaleString();

            document.getElementById('resPrincipal').innerText = "NT$ " + Math.round(accumulatedPrincipal).toLocaleString();

            let netProfit = 0;
            if (isLeverage && loanType === 'invest') {
                netProfit = totalBenefit - accumulatedPrincipal - loanAmount;
            } else {
                netProfit = totalBenefit - accumulatedPrincipal;
            }

            document.getElementById('resNetProfit').innerText = (netProfit >= 0 ? "+" : "") + "NT$ " + Math.round(netProfit).toLocaleString();

            if (isLeverage) {
                document.getElementById('loanCostRow').style.display = 'flex';
                document.getElementById('resTotalLoanInterest').innerText = "- NT$ " + Math.round(totalLoanInterestPaid).toLocaleString();
            } else {
                document.getElementById('loanCostRow').style.display = 'none';
            }

            if(payoutType === 'cash') {
                document.getElementById('monthlyDrawRow').style.display = 'flex';
                document.getElementById('resMonthlyDraw').innerText = "NT$ " + Math.round(totalCashDraw / months).toLocaleString();
            } else {
                document.getElementById('monthlyDrawRow').style.display = 'none';
            }

            let deathBenefit = Math.max(sumAssured, currentAccountValue);
            document.getElementById('resDeathBenefit').innerText = "NT$ " + Math.round(deathBenefit).toLocaleString();
            document.getElementById('resSumAssured').innerText = "NT$ " + Math.round(sumAssured).toLocaleString();

            if (currentMode === 'lumpSum' && accumulatedPrincipal > 0) {
                 document.getElementById('roeBlock').style.display = 'block';
                 let annualizedROE = (netProfit / totalYears / accumulatedPrincipal) * 100;
                 document.getElementById('resROE').innerText = annualizedROE.toFixed(2) + "%";
            } else {
                document.getElementById('roeBlock').style.display = 'none';
            }

            document.getElementById('resYearLabel').innerText = totalYears;
            document.getElementById('resultArea').style.display = 'block';
            document.getElementById('resultArea').scrollIntoView({behavior: "smooth"});
        }
    </script>
</body>
</html>
